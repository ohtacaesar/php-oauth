set $role "";

error_page 401 @login;

location @login {
    return 302 http://auth.example.com?rd=${scheme}://${host}${request_uri};
}

location .auth {
    internal;
    proxy_pass http://auth.example.com/auth;
    proxy_set_header ROLE $role;
    set $role "";
}
